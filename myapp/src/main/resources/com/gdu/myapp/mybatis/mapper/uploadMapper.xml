<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper
  PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
  "https://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="com.gdu.myapp.mapper.UploadMapper">

  <!-- <resultMap type="UploadDto" id="UploadMap">
    <id property="uploadNo" column="UPLOAD_NO" />
    <result property="title" column="TITLE"/>
    <result property="contents" column="CONTENTS"/>
    <result property="createDt" column="CREATE_DT"/>
    <result property="modifyDt" column="MODIFY_DT"/>
    <association property="user" javaType="UserDto">
      <id property="userNo" column="USER_NO" />
      <result property="email" column="EMAIL" />
    </association>
  </resultMap> -->
  
  <!-- INSERT 수행 이전(SELECT 먼저 동작)에 파라미터 UploadDto 의 uploadNo속성(필드)에 UPLOAD_SEQ.NEXTVAL 값을 저장한다. -->
  <insert id="insertUpload"
          parameterType="UploadDto">
    <selectKey order="BEFORE" keyProperty="uploadNo" resultType="int">
      SELECT UPLOAD_SEQ.NEXTVAL
        FROM DUAL
    </selectKey>
    INSERT INTO UPLOAD_T (
        UPLOAD_NO
      , TITLE
      , CONTENTS
      , CREATE_DT
      , MODIFY_DT
      , USER_NO
    ) VALUES (
        #{uploadNo}
      , #{title}
      , #{contents}
      , TO_CHAR(CURRENT_DATE, 'YYYY-MM-DD HH24:MI:SS')   <!-- DB에서 VARCHAR 로 받아왔기 때문에 TO_CHAR 을 이용해서 날짜로 변환 -->
      , TO_CHAR(CURRENT_DATE, 'YYYY-MM-DD HH24:MI:SS')
      , #{user.userNo}
    )
  </insert>
  
  <insert id="insertAttach"
          parameterType="AttachDto">
    INSERT INTO ATTACH_T (
        ATTACH_NO
      , UPLOAD_PATH
      , FILESYSTEM_NAME
      , ORIGINAL_FILENAME
      , DOWNLOAD_COUNT
      , HAS_THUMBNAIL
      , UPLOAD_NO
    ) VALUES (
        ATTACH_SEQ.NEXTVAL
      , #{uploadPath}
      , #{filesystemName}
      , #{originalFilename}
      , 0
      , #{hasThumbnail}
      , #{uploadNo}
    )
  </insert>


  
</mapper>
